dataSources:
  messages:
    type: "list"
    value:
      - ["ERROR", "Could not access Orders database", "connect"]
      - ["INFO", "Executing order-create action", "order-create"]
      - ["INFO", "Executing order-discard action", "order-discard"]
      - ["INFO", "Executing order-submit action", "order-submit"]
      - ["INFO", "Executing order-submit action", "order-submit"]
      - ["INFO", "Executing order-submit action", "order-submit"]
      - ["WARNING", "Database response time was slow (over 250ms)", "connect"]
      - ["INFO", "Executing order-create action", "order-create"]
      - ["INFO", "Executing order-create action", "order-create"]
      - ["DEBUG", "Initializing app", "init"]
  vmId:
    type: "gce-metadata"
    value: "instance/id"
  vmZone:
    type: "gce-metadata"
    value: "instance/zone"
  vmProjectId:
    type: "gce-metadata"
    value: "project/project-id"

loggingJobs:

  - logName: "eshop-orders"
    startOffset: "-48h"
    frequency: "45s~3m"
    jsonPayload:
      message: "{messages[1]}"
      action: "{messages[2]}"
    level: "{messages[0]}"
    resourceType: "gce_instance"
    resourceLabels:
      instance_id: "{vmId}"
      project_id: "{vmProjectId}"
      zone: "{vmZone}"
    variables:
      - name: "messages"
        selector: "any"
      - name: "action"
        dataSource: "actions"
        selector: "any"
      - "vmProjectId"
      - "vmId"
      - name: "vmZone"
        extractor: "/zones/([a-z0-9\\-]+)$"

  - logName: "eshop-orders"
    startOffset: "-48h"
    frequency: "20h~72h"
    textPayload: "Looks like systems may be going down soon! Act Now!"
    level: "EMERGENCY"
    resourceType: "gce_instance"
    resourceLabels:
      instance_id: "{vmId}"
      project_id: "{vmProjectId}"
      zone: "{vmZone}"
    variables:
      - "vmProjectId"
      - "vmId"
      - name: "vmZone"
        extractor: "/zones/([a-z0-9\\-]+)$"

  - logName: "eshop-orders"
    startOffset: "-48h"
    frequency: "2h-4h"
    textPayload: "{messages[1]} - Action: {messages[2]}"
    level: "{messages[0]}"
    resourceType: "gce_instance"
    resourceLabels:
      instance_id: "{vmId}"
      project_id: "{vmProjectId}"
      zone: "{vmZone}"
    variables:
      - name: "messages"
        selector: "any"
      - name: "action"
        dataSource: "actions"
        selector: "any"
      - "vmProjectId"
      - "vmId"
      - name: "vmZone"
        extractor: "/zones/([a-z0-9\\-]+)$"

dataSources:
  messages:
    type: "list"
    value:
      - ["ERROR", "Could not access Orders database", "connect"]
      - ["INFO", "Executing order-create action", "order-create"]
      - ["INFO", "Executing order-create action", "order-create"]
      - ["INFO", "Executing order-discard action", "order-discard"]
      - ["NOTICE", "Stock request to fulfill order-create action", "order-stock"]
      - ["INFO", "Executing order-submit action", "order-submit"]
      - ["INFO", "Executing order-submit action", "order-submit"]
      - ["INFO", "Executing order-submit action", "order-submit"]
      - ["WARNING", "Database response time was slow (over 250ms)", "connect"]
      - ["INFO", "Executing order-create action", "order-create"]
      - ["NOTICE", "Stock request to fulfill order-create action", "order-stock"]
      - ["INFO", "Executing order-create action", "order-create"]
      - ["INFO", "Executing order-create action", "order-create"]
      - ["DEBUG", "Initializing app", "init"]
  cnxlogs:
    type: "list"
    value:
      - ["CRITICAL", "Too many denied attempts from"]
      - ["INFO", "Access succeeded from"]
      - ["WARNING", "Access succeeded from"]
  logName:
    type: "list"
    value:
      - "python"
      - "eshop-test"
  ips:
    type: "list"
    value:
      - "111.144.187.212"
      - "233.142.26.173"
      - "65.44.51.196"
      - "229.15.109.233"
      - "210.34.246.74"
      - "136.250.243.161"
      - "83.8.35.71"
      - "2.116.82.111"
      - "106.237.14.54"
      - "13.30.17.185"
      - "77.68.25.151"
      - "106.81.246.38"
      - "141.4.119.20"
      - "244.102.94.157"
      - "77.121.52.139"
      - "13.30.17.14"
      - "13.30.17.94"
      - "13.30.17.108"
      - "13.30.17.122"
      - "13.30.17.255"
      - "13.30.17.246"
      - "13.30.17.165"
      - "13.30.17.17"
  vmId:
    type: "gce-metadata"
    value: "instance/id"
  vmZone:
    type: "gce-metadata"
    value: "instance/zone"
  vmProjectId:
    type: "gce-metadata"
    value: "project/project-id"
  actionId:
    type: "random"
    value: "int"
    range: "32109 ~ 76543"

loggingJobs:

  - logName: "{logName}"
    startOffset: "-48h"
    resourceType: "gce_instance"
    resourceLabels:
      instance_id: "{vmId}"
      project_id: "{vmProjectId}"
      zone: "{vmZone}"
    variables:
      - "vmProjectId"
      - "vmId"
      - "actionId"
      - "logName"
      - name: "messages"
        selector: "any"
      - name: "vmZone"
        extractor: "/zones/([a-z0-9\\-]+)$"
    loggingEntries:
      - frequency: "90s~5m"
        jsonPayload:
          message: "{messages[1]}"
          action: "{messages[2]}"
        level: "{messages[0]}"
        variables:
          - name: "ips"
            selector: "1"
      - frequency: "12h~52h"
        textPayload: "Looks like systems may be going down soon! Act Now!"
        level: "EMERGENCY"
      - frequency: "3h~4h"
        textPayload: "{messages[1]} - Action: #{actionId} {messages[2]}"
        level: "{messages[0]}"
      - startOffset: "-24h"
        endOffset: "-23h"
        frequency: "1h"
        textPayload: "{messages[1]} - Action: #15365 {messages[2]}"
        level: "{messages[0]}"

  - logName: "eshop-orders"
    startOffset: "-48h"
    resourceType: "gce_instance"
    resourceLabels:
      instance_id: "{vmId}"
      project_id: "{vmProjectId}"
      zone: "{vmZone}"
    variables:
      - name: "messages"
        selector: "any"
      - "vmProjectId"
      - "vmId"
      - name: "vmZone"
        extractor: "/zones/([a-z0-9\\-]+)$"
    loggingEntries:
      - frequency: "40s~3m"
        jsonPayload:
          message: "{messages[1]}"
          action: "{messages[2]}"
        level: "{messages[0]}"
      - frequency: "20h~72h"
        textPayload: "Looks like systems may be going down soon! Act Now!"
        level: "EMERGENCY"
      - frequency: "2h~4h"
        textPayload: "{messages[1]} - Action: #{actionId} {messages[2]}"
        level: "{messages[0]}"
        variables:
          - "actionId"
      - frequency: "2h~4h"
        textPayload: "{messages[1]} - Action: {messages[2]}"
        level: "{messages[0]}"

  - logName: "eshop-server"
    startOffset: "-48h"
    resourceType: "gce_instance"
    resourceLabels:
      instance_id: "{vmId}"
      project_id: "{vmProjectId}"
      zone: "{vmZone}"
    variables:
      - name: "ips"
        selector: "any"
      - name: "cnxlogs"
        selector: "any"
      - "vmProjectId"
      - "vmId"
      - name: "vmZone"
        extractor: "/zones/([a-z0-9\\-]+)$"
    loggingEntries:
      - frequency: "2m~5m"
        jsonPayload:
          message: "{cnxlogs[1]} {ips}"
          source: "{ips}"
        level: "{cnxlogs[0]}"
      - startOffset: "-3h"
        endOffset: "-2h30m"
        frequency: "5s~15s"
        jsonPayload:
          message: "{cnxlogs[1]} {ips}"
          source: "{ips}"
        level: "{cnxlogs[0]}"
        variables:
          - name: "ips"
            selector: "1"
